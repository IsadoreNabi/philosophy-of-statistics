---
title: "BAYESIAN ECONOMIC DISAGGREGATION: A DETERMINISTIC, DIAGNOSTICS-FIRST WORKFLOW"
description: "From Prior Weights to Posterior Sectoral Shares With Coherence, Stability, and Interpretability Metrics—Plus a Synthetic Demo."
author: "José Mauricio Gómez Julián"
date: 2025-09-17
categories: [R, packages, Bayesian, Econometrics, Data Science, Statistics, Time Series, Disaggregation, PCA, SVD, Bayesian Inference, Compositional Data, Economic Analysis, CPI, Inflation, Uncertainty Quantification, Analytical Methods, Structure Transfer, Neuroscience Applications, Climate Science, Epidemiology, Signal Processing, Machine Learning, Policy Analysis, Central Banking, Research, Method, Marx, Engels, GitHub]
format:
  html:
    toc: true
    code-copy: true
execute:
  echo: true
  warning: false
  message: false
---

> This article summarizes a practical framework for sectoral disaggregation of aggregate indices (e.g., CPI) using deterministic posterior updates and explicit diagnostics. The approach is implemented in the `BayesianDisaggregation` R package and emphasizes coherence with a sectoral likelihood, numerical/temporal stability, and interpretability.

```{r}
#| label: setup
#| include: false
# Mostrar errores en la página en lugar de abortar el render
knitr::opts_chunk$set(error = TRUE)

# Cargar paquete si está instalado
have_pkg <- requireNamespace("BayesianDisaggregation", quietly = TRUE)
if (have_pkg) {
  library(BayesianDisaggregation)
}
```

## 1. Problem Setup

Consider an aggregate index observed over periods (t = 1,\dots,T). The goal is a sectoral decomposition into (K) components whose shares lie on the unit simplex, with rows that sum to one. The workflow starts from a prior weight matrix (P \in \mathbb{R}\^{T \times K}) (row-stochastic), builds a sectoral likelihood vector (L \in \Delta\^{K-1}), spreads it over time into (L_T \in \mathbb{R}\^{T \times K}), and applies a deterministic update to obtain the posterior (W) (also row-stochastic).

## 2. Constructing the Sectoral Likelihood (L)

**PC1 Salience.** Columns of (P) are centered over time; an SVD/PCA is computed on the centered matrix. The first right singular vector’s absolute entries are normalized to obtain a non-negative (L). When PC1 is degenerate, a fallback uses column means of (P) (renormalized). Attributes record loadings, explained variance and the fallback flag.

**Temporal Spreading.** A non-negative profile (w_t) spreads (L) into (L_T) by row-normalization. Built-in patterns include `constant`, `recent` (linearly increasing in (t)), `linear`, and `bell`.

``` r
# From the package:
# L  <- compute_L_from_P(P)
# LT <- spread_likelihood(L, T_periods = nrow(P), pattern = "recent")
```

## 2. Deterministic Posterior Updates (MCMC-Free)

Four options are provided:

-   **Weighted Average:** $W = \text{norm1}\{\lambda P + (1-\lambda) L_T\}$.
-   **Multiplicative:** $W = \text{norm1}\{P \odot L_T\}$.
-   **Dirichlet Mean:** analytic conjugacy with γ\>0; smaller γ sharpens the posterior mean.
-   **Adaptive Mixing:** sector-wise mixing scales by prior volatility.

``` r
# posterior_weighted(P, LT, lambda = 0.7)
# posterior_multiplicative(P, LT)
# posterior_dirichlet(P, LT, gamma = 0.1)
# posterior_adaptive(P, LT)
```

All updates keep rows on the simplex by construction.

## 3. Diagnostics: Coherence, Stability, Interpretability

-   **Coherence:** correlation gain of the posterior temporal mean $\bar{w}$ vs. prior $\bar{p}$ with respect to $L$, bounded in $[0,1]$ via a linear scale.
-   **Numerical & Temporal Stability:** exponential penalty for row-sum deviation/negatives plus a smoothness score based on average absolute differences over time; combined into a composite stability score.
-   **Interpretability:** preservation of sectoral structure (corr$(\bar{p},\bar{w})$) and plausibility of average relative shifts (90th percentile). Implementation is exposed as `coherence_score()`, `numerical_stability_exp()`, `temporal_stability()`, `stability_composite()`, and `interpretability_score()`.

## 4. End-To-End API

A convenience wrapper orchestrates I/O, likelihood construction, posterior, metrics, and exports.

``` r
# bayesian_disaggregate(
#   path_cpi, path_weights,
#   method = c("weighted","multiplicative","dirichlet","adaptive"),
#   lambda = 0.7, gamma = 0.1,
#   coh_mult = 3.0, coh_const = 0.5,
#   stab_a = 1000, stab_b = 10, stab_kappa = 50,
#   likelihood_pattern = "recent"
# )
```

Outputs include a tidy posterior $W$, diagnostics, optional Excel exports, and quick plots.

## 5. Synthetic and Reproducible Demo

The following chunk synthesizes a small prior, derives $L$ and $L_T$, compares posteriors, and computes key metrics. It renders quickly on any machine.

```{r demo-synthetic, eval=have_pkg}
set.seed(123)
T <- 10; K <- 6
P <- matrix(rexp(T*K), nrow = T); P <- P / rowSums(P)

L  <- compute_L_from_P(P)                       # PCA/SVD with robust fallback
LT <- spread_likelihood(L, T, pattern = "recent")

W_adapt <- posterior_adaptive(P, LT)            # recommended when sector volatilities differ
coh  <- coherence_score(P, W_adapt, L)
stab <- stability_composite(W_adapt, a = 1000, b = 10, kappa = 50)
intr <- interpretability_score(P, W_adapt)

eff  <- 0.65                                    # heuristic efficiency placeholder
comp <- 0.30*coh + 0.25*stab + 0.25*intr + 0.20*eff

round(data.frame(coherence=coh, stability=stab, interpretability=intr,
                 efficiency=eff, composite=comp), 4)
```

The demo mirrors the manual’s quick example and target ranges.

## 6. Real-Data Pipeline (Disabled for Speed)

Switch `eval: true` after setting paths to local Excel files. This runs the compact grid, re-executes the best configuration, and writes a single Excel with all artifacts.

```{r real-data, eval=FALSE}
# Example paths (Windows: use forward slashes or raw strings)
path_cpi <- "E:/Carpeta de Estudio/.../CPI.xlsx"
path_w   <- "E:/Carpeta de Estudio/.../PESOS VAB.xlsx"

base_res <- bayesian_disaggregate(
  path_cpi = path_cpi, path_weights = path_w,
  method = "adaptive",
  lambda = 0.7, gamma = 0.1,
  coh_mult = 3.0, coh_const = 0.5,
  stab_a = 1000, stab_b = 10, stab_kappa = 60,
  likelihood_pattern = "recent"
)

base_res$metrics
```

A minimal grid search and one-file Excel export can be added following the package helpers.

## 7. Reading the Visuals

A posterior heatmap reveals sectoral persistence and smoothness over time; top-sectors line plots emphasize dominant components; the sectoral-CPI sheet shows $\hat{Y}_{t,k} = \text{CPI}_t \times W_{t,k}$, enabling a decomposed view of the aggregate series.

## 8. Practical Defaults

Adaptive mixing is robust under heterogeneous prior volatility; otherwise the weighted rule with $\lambda \in [0.7, 0.9]$ often performs strongly. Coherence scaling $(\texttt{mult}=3.0,\ \texttt{const}=0.5)$ yields a bounded, interpretable 0–1 score. The exponential numerical penalty is intentionally sharp to enforce row-stochasticity in automated runs.

# 9. Key Innovation

*This package represents a methodological contribution to econometrics and data science, providing the first analytical solution to the structure transfer problem with uncertain intermediaries.*

The package's breakthrough lies in recognizing that PCA on temporally-centered disaggregation weights yields exactly the likelihood signal needed for Bayesian updating. This enables: - **Formal uncertainty quantification** rather than ad-hoc treatment - **Analytical solutions** for tractable sample sizes - **Transparent propagation** of proxy uncertainty to final results

## 9.1. Summary of Related Methods and Where This package Fits

**Problem.** You often want to compare an **aggregate** series $X_t$ (e.g., CPI) with a **disaggregated** series $Y_{t,k}$ across sectors $k$, but only have an **imperfect intermediary** $Z_{t,k}$ that approximates the cross-sectional structure (e.g., sectoral value added). The conceptual challenge is **transferring structure** from $Z$ to disaggregate $X$, while **honestly accounting for uncertainty** in $Z$.

**What this package does.** The package treats $Z$ as a **Bayesian prior** over sectoral weights $P_{t,k}$ (rows on the probability simplex), extracts a **low-dimensional temporal signal** via **PCA computed by SVD** on the time-centered matrix $Z$, and uses that signal as an **analytical likelihood** to obtain a **closed-form posterior** $W_{t,k}$ for the weights. The updated weights then disaggregate $X_t$ into $X_{t,k}=W_{t,k}\,X_t$. This is entirely **MCMC-free** and computationally light. Conceptually, it is a **structure-transfer** method with an **uncertain intermediary** and an **analytical update**.

**What we did *not* find in the literature.** We did not find a prior, named methodology that (i) takes an **uncertain structural intermediary** $Z$, (ii) **derives a temporal likelihood** from **PCA/SVD** of $Z$, and (iii) performs an **analytical Bayesian update** to produce posterior disaggregation weights that remain **row-stochastic** and are used to disaggregate an unrelated aggregate $X_t$. There are adjacent traditions, but each misses at least one of these pieces:

-   **Biproportional balancing / RAS / IPF.** Classic RAS adjusts a matrix to match new margins by **multiplying rows/columns** iteratively (Deming & Stephan, 1940, pp. 28–29; overviews referencing Bacharach, 1970). It **doesn’t** construct a likelihood from PCA/SVD nor deliver a **probabilistic posterior on the simplex** for use as disaggregation weights. It’s a deterministic reconciliation method for totals, not a Bayesian structure-transfer with an uncertain intermediary.
-   **Temporal disaggregation** (Denton, Chow–Lin, Fernández). These methods distribute **low-frequency aggregates** into higher frequency using a related indicator series, via smoothness/BLU estimators (Eurostat, 2013, pp. 79–98; see Denton-type formulations; Chow–Lin and Fernández are discussed there). They **do not** address **cross-sectional** disaggregation with **simplex-valued weights** nor use PCA-derived likelihoods.
-   **Forecast reconciliation for hierarchies** (e.g., MinT). This reconciles **inconsistent forecasts across aggregation trees** by projecting onto a coherent subspace (Wickramasuriya et al., 2019, pp. 1–3). It is *forecast*-centric and linear-algebraic—not a Bayesian update for **compositional** weights with PCA-likelihoods.
-   **Compositional/Bayesian state-space models** exist (e.g., Dirichlet evolutions), but we did not find an **analytical** 1-step update that (a) builds its **likelihood from PCA/SVD of** $Z$ and (b) outputs **posterior weights** to **disaggregate a different aggregate series** $X_t$.

**Takeaway.** To our knowledge, the package provides a **new, analytical** approach to the “structure transfer with uncertain intermediary” problem in the specific setting of **time-varying, simplex-valued weights**: it uses **PCA via SVD** on $Z$ to define a **temporal likelihood**, and then performs a **closed-form Bayesian update** to posterior weights that can immediately **disaggregate** $X_t$. That makes it distinct from RAS/IPF balancing, from temporal-frequency disaggregation (Denton/Chow–Lin/Fernández), and from hierarchical forecast reconciliation.

## 9.2. References

Deming, W. E., & Stephan, F. F. (1940). On a least squares adjustment of a sampled frequency table when the expected marginal totals are known. *The Annals of Mathematical Statistics, 11*(4), 427–444. <https://doi.org/10.1214/aoms/1177731829> (see method description on pp. 428–430 for the iterative proportional fitting idea). (\[[apps.bea.gov](https://apps.bea.gov/scb/pdf/2008/05%20May/0508_methods.pdf?utm_source=chatgpt.com)\]\[1\])

Eurostat. (2013). *Handbook on quarterly national accounts* (2013 edition). Publications Office of the European Union. (See Chapter “Benchmarking and temporal disaggregation,” esp. the Denton formulation and BLU approaches, pp. 79–98.)

International Labour Organization (ILO), International Monetary Fund (IMF), Organisation for Economic Co-operation and Development (OECD), Eurostat, United Nations Economic Commission for Europe (UNECE), & The World Bank. (2020). *Consumer Price Index Manual: Concepts and Methods*. IMF. (Aggregation structure and weighting practices are explained throughout; see e.g. Ch. 3 on index number theory and aggregation). (\[[Scribd](https://www.scribd.com/document/915498814/Input-Output-Analysis-Foundations-and-Extensions-2nd-edition-Ronald-E-Miller-pdf-version?utm_source=chatgpt.com)\]\[2\])

Wickramasuriya, S. L., Athanasopoulos, G., & Hyndman, R. J. (2019). Optimal forecast reconciliation for hierarchical and grouped time series through trace minimization. *Statistica Sinica, 30*(4), 1555–1586. (Preprint version available as arXiv:1805.07245; see Sections 1–2 for the reconciliation setup.) (\[[Scribd](https://www.scribd.com/document/794344468/Book4-SVD?utm_source=chatgpt.com)\]\[3\])

### 9.2.1. Notes on Scope and Claims

-   **On novelty.** Because adjacent areas are vast, we phrase novelty as **“to our knowledge, we did not find …”** rather than an absolute first. The distinctive combination here is: **(i)** uncertain **intermediary** $Z$ treated as a **prior on the simplex**, **(ii)** **likelihood built from PCA via SVD** on time-centered $Z$, and **(iii)** **analytical (non-MCMC) posterior** used to **disaggregate an unrelated aggregate** $X_t$.
-   **On CPI examples.** Public CPI databases (e.g., headline CPI and coarse categories) typically lack rich sectoral disaggregation tied to national accounts—hence the need to **transfer structure** from a proxy like $Z$ (e.g., value added) rather than rely on directly observed $X_{t,k}$. The CPI Manual (2020) documents aggregation frameworks and weights at a conceptual level but does not provide a ready-made cross-sectional mapping suited to your use case (see CPI Manual, 2020). \[1\]: [https://apps.bea.gov/scb/pdf/2008/05%20May/0508_methods.pd](https://apps.bea.gov/scb/pdf/2008/05%20May/0508_methods.pdf?utm_source=chatgpt.com)f "An Empirical Review of Methods for Temporal Distribution ..." \[2\]: [https://www.scribd.com/document/915498814/Input-Output-Analysis-Foundations-and-Extensions-2nd-edition-Ronald-E-Miller-pdf-version](https://www.scribd.com/document/915498814/Input-Output-Analysis-Foundations-and-Extensions-2nd-edition-Ronald-E-Miller-pdf-version?utm_source=chatgpt.com) "Input Output Analysis Foundations and Extensions 2nd" \[3\]: [https://www.scribd.com/document/794344468/Book4-SVD](https://www.scribd.com/document/794344468/Book4-SVD?utm_source=chatgpt.com) "Book4 SVD \| PDF \| Principal Component Analysis"

## 9.3. Economic Applications

### 9.3.1. Disaggregating Consumer Price Index

This package enables analyses that were previously impossible:

-   **Which sectors are truly driving inflation?** Decompose CPI by economic activity to identify inflation sources

-   **How do price shocks differentially affect industries?** Understand sector-specific impacts of monetary policy

-   **What are the real sectoral price dynamics?** Track inflation patterns at the industry level

These are questions policymakers need answered but couldn't address with existing tools. No traditional methods exist for disaggregating CPI by economic sector because the mapping between consumer prices and productive sectors is inherently uncertain.

## 9.4. Applications Beyond Economics

The framework generalizes to any domain with the **structure transfer problem**:

### 9.4.1. Neuroscience

Relate global brain activity (aggregated) to specific cognitive functions (disaggregated) using imperfect anatomical mappings. Understand which brain regions contribute to observed EEG/MEG signals while accounting for spatial uncertainty.

### 9.4.2. Climate Science 

Distribute global climate projections to regional levels using uncertain downscaling models. Project temperature/precipitation changes from coarse climate models to local watersheds while quantifying projection uncertainty.

### 9.4.3. Epidemiology

Allocate national mortality rates to specific subpopulations using imperfect demographic proxies. Decompose country-level disease burden to demographic groups when direct measurements are unavailable.

### 9.4.4. Signal Processing

Reconstruct high-frequency components from compressed signals using approximate dictionaries. Recover detailed structure from aggregated measurements in compressed sensing applications.

### 9.4.5. Machine Learning

Transfer knowledge from source domains to granular target domains through noisy intermediate representations. Apply domain adaptation when the mapping between domains is uncertain.

## 9.5. Real-World Impact

By providing the first principled method for CPI disaggregation, this package opens new analytical frontiers:

-   **Central banks** can identify sector-specific inflation drivers for targeted policy

-   **Researchers** can study differential price transmission across industries

-   **Analysts** can decompose aggregate shocks into sectoral components

-   **Policymakers** can design interventions based on granular inflation dynamics

The framework's generality means similar breakthroughs are possible wherever the **structure transfer problem** appears—from neuroscience to climate modeling.
